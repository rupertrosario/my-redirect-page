# 1) Add ONCE near the top (after you build $headers)
function Invoke-HeliosJson {
  param(
    [Parameter(Mandatory)] [string]$Uri,
    [Parameter(Mandatory)] [hashtable]$Headers,
    [object]$Body = $null,
    [int]$TimeoutSec = 20
  )
  try {
    $r = Invoke-WebRequest -Method Get -Uri $Uri -Headers $Headers -Body $Body -TimeoutSec $TimeoutSec -ErrorAction Stop
    try { return ($r.Content | ConvertFrom-Json) } catch { return $null }   # non-JSON/HTML body
  } catch {
    $code = $null
    try { $code = [int]$_.Exception.Response.StatusCode } catch {}
    if ($code -in 502,503,504,408) { return $null } # gateway/timeout/down
    return $null                                     # silent for all other failures too
  }
}

# 2) Replace your per-cluster request+ConvertFrom-Json blocks with:
$json  = Invoke-HeliosJson -Uri $URL1 -Headers $headers -Body $body
$json1 = Invoke-HeliosJson -Uri $URL2 -Headers $headers

# 3) Skip cluster if either call failed
if (-not $json -or -not $json1) { continue }
