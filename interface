# assumes you already have:
# $headers = @{
#   "apiKey" = $ApiKey
#   "accessClusterId" = "$cluster_id"
# }

    "accessClusterId" = "$cluster_id"
}

$url = "https://helios.cohesity.com/irisservices/api/v1/public/interface"

$body = @{
  bondInterfaceOnly       = "true"
  ifaceGroupAssignedOnly  = "true"
  includeUplinkSwitchInfo = "true"
  includeBondSlavesDetails = "true"
  includeStats            = "true"
}

$response = Invoke-WebRequest -Method Get -Uri $url -Headers $headers -Body $body
$json = $response.Content | ConvertFrom-Json
#$json2 = $json.interfaces.bondSlavesDetails
#$json2

foreach ($node in $json) {
    $results = [PSCustomObject]@{
        Cluster               = $cluster_name
        NodeID                = $node.nodeId
        NodeIP                = $node.nodeIp
        ChassisSerial         = $node.chassisSerial
        #InterfaceGroup       = $node.interfaces.group
        #BondName             = $name
        #BondLinkSpeed        = $node.interfaces.speed
        BondSlaves            = $node.interfaces.bondSlaves
        SlaveInterfaceStatus  = $node.interfaces.bondSlavesDetails.linkState
        SlaveSpeed            = $node.interfaces.bondSlavesDetails.speed
        SlotType              = $node.interfaces.bondSlavesSlotTypes
        #UplinkSwitchInfo     = $node.interfaces.bondSlavesDetails.uplinkSwitchInfo.sysName
        #SwitchPortId         = $node.interfaces.bondSlavesDetails.uplinkSwitchInfo.portId
    }
}

$results | Format-Table -AutoSize

<#if ($results.Count -gt 0) {
    Write-Host "Objects with Errors:"

    $results | Export-Csv -Path "H:\Cohesity_API\Logs\objects_errors.csv" -NoTypeInformation -Encoding UTF8
} else {
    Write-Host " All Objects are healthy. No errors to display."
}
#>
