export default async function () {
  console.log("🔍 Fetching Cohesity Helios clusters (corrected keys)...");

  // 🔐 Paste your working Helios API key here
  const apiKey = "PASTE_YOUR_API_KEY_HERE";
  const baseUrl = "https://helios.cohesity.com";
  const headers = { accept: "application/json", apiKey };

  const resp = await fetch(`${baseUrl}/v2/mcm/cluster-mgmt/info`, { headers });
  console.log(`➡️ HTTP status: ${resp.status}`);

  if (resp.status !== 200) {
    throw new Error(`❌ Failed to fetch clusters (HTTP ${resp.status})`);
  }

  const data = await resp.json();

  // ✅ Use the correct lowercase keys
  const clusters = data?.cohesityClusters?.map(c => ({
    clusterName: c.clusterName,
    clusterId: c.clusterId
  })) || [];

  if (clusters.length === 0) {
    console.log("⚠️ No clusters returned — check API key scope or region.");
  } else {
    console.log("✅ Clusters found:");
    clusters.forEach(c => console.log(`   • ${c.clusterName} (ID: ${c.clusterId})`));
  }

  // Return to workflow output
  return { count: clusters.length, clusters };
}
