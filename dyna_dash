export default async function () {
  console.log("ðŸ” Fetching Cohesity Helios clusters (corrected keys)...");

  // ðŸ” Paste your working Helios API key here
  const apiKey = "PASTE_YOUR_API_KEY_HERE";
  const baseUrl = "https://helios.cohesity.com";
  const headers = { accept: "application/json", apiKey };

  const resp = await fetch(`${baseUrl}/v2/mcm/cluster-mgmt/info`, { headers });
  console.log(`âž¡ï¸ HTTP status: ${resp.status}`);

  if (resp.status !== 200) {
    throw new Error(`âŒ Failed to fetch clusters (HTTP ${resp.status})`);
  }

  const data = await resp.json();

  // âœ… Use the correct lowercase keys
  const clusters = data?.cohesityClusters?.map(c => ({
    clusterName: c.clusterName,
    clusterId: c.clusterId
  })) || [];

  if (clusters.length === 0) {
    console.log("âš ï¸ No clusters returned â€” check API key scope or region.");
  } else {
    console.log("âœ… Clusters found:");
    clusters.forEach(c => console.log(`   â€¢ ${c.clusterName} (ID: ${c.clusterId})`));
  }

  // Return to workflow output
  return { count: clusters.length, clusters };
}
