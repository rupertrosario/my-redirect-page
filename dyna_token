import { credentialVaultClient } from "@dynatrace-sdk/client-classic-environment-v2";

export default async function () {
  // Fetch your stored credential securely by its ID
  const vaultData = await credentialVaultClient.getCredentialsDetails({
    id: "credentials_vault-312312"
  });

  // Extract the actual key (token)
  const apiKey = vaultData.token;
  console.log(`âœ… Loaded API key from vault: ${vaultData.name}`);

  // Use it in your API call
  const headers = { accept: "application/json", apiKey };
  const url = "https://helios.cohesity.com/v2/mcm/cluster-mgmt/info";
  const resp = await fetch(url, { method: "GET", headers });
  const data = await resp.json();

  console.log(`Cluster count: ${data?.cohesityClusters?.length || 0}`);

  return { clusterCount: data?.cohesityClusters?.length || 0 };
}
