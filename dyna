/**
 * Dynatrace Synthetic JavaScript — One-time Cohesity API test
 * Usage: Paste your API key below only when you run it manually.
 */

const apiKey = "<PASTE_COHESITY_API_KEY_HERE>"; // 🔒 Not saved anywhere
if (!apiKey || apiKey.startsWith("<PASTE")) {
  fail("⚠️ Please paste your Cohesity API key into the apiKey variable before running this test.");
}

const url = "https://helios.cohesity.com/irisservices/api/v1/public/clusters";
const headers = {
  "Accept": "application/json",
  "Authorization": "Bearer " + apiKey
};

// ---- Perform GET ----
const response = http.get(url, { headers });

// ---- Check result ----
if (response.statusCode !== 200) {
  fail(`Cohesity API failed with status ${response.statusCode}: ${response.body}`);
}

// ---- Parse + log ----
const json = JSON.parse(response.body);
for (let cluster of json) {
  log.info(`✅ Cluster: ${cluster.name}, Health: ${cluster.healthStatus}, Version: ${cluster.clusterSoftwareVersion}`);
}
