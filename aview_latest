$ErrorActionPreference = 'Stop'

# ----------------------------------------------
# ðŸ”¢ Lookback window (days) for growth
# ----------------------------------------------
$Days = 7   # last 7 days

# -------------------------------------------------------------
# ðŸ“ Log directory + hygiene
# -------------------------------------------------------------
$logDirectory = "X:\PowerShell\Data\Cohesity\"
if (-not (Test-Path -Path $logDirectory -PathType Container)) {
    New-Item -Path $logDirectory -ItemType Directory | Out-Null
}

# Hygiene 1: keep at most 50 newest files
try {
    $files = Get-ChildItem -Path $logDirectory -File -ErrorAction Stop
    if ($files.Count -gt 50) {
        $toDelete = $files | Sort-Object CreationTime | Select-Object -First ($files.Count - 50)
        $count    = ($toDelete | Measure-Object).Count
        if ($count -gt 0) {
            $toDelete | Remove-Item -Force -ErrorAction SilentlyContinue
            Write-Host "ðŸ§¹ Removed $count old files to keep last 50."
        }
    }
} catch {}

# Hygiene 2: delete anything older than 30 days
try {
    $threshold = (Get-Date).AddDays(-30)
    $older = Get-ChildItem -Path $logDirectory -File -ErrorAction SilentlyContinue |
             Where-Object { $_.LastWriteTime -lt $threshold }
    $oldCount = ($older | Measure-Object).Count
    if ($oldCount -gt 0) {
        $older | Remove-Item -Force -ErrorAction SilentlyContinue
        Write-Host "ðŸ§½ Deleted $oldCount files older than 30 days."
    }
} catch {}

# -------------------------------------------------------------
# 0ï¸âƒ£ API key from your path
# -------------------------------------------------------------
$apikeypath = "X:\PowerShell\Cohesity_API_Scripts\DO_NOT_Delete\apikey.txt"
if (-not (Test-Path $apikeypath)) {
    throw "API key file not found at $apikeypath"
}

$apiKey        = (Get-Content -Path $apikeypath -Raw).Trim()
$commonHeaders = @{ "apiKey" = $apiKey }

# Base URLs
$baseMcm  = "https://helios.cohesity.com/v2/mcm"
$baseIris = "https://helios.cohesity.com/irisservices/api/v1/public"

# -------------------------------------------------------------
# 1ï¸âƒ£ Get Clusters (ClusterName + ClusterId) via GET
# -------------------------------------------------------------
$url      = "$baseMcm/cluster-mgmt/info"
$response = Invoke-WebRequest -Method Get -Uri $url -Headers $commonHeaders
$json     = $response.Content | ConvertFrom-Json
$json_clu = $json.cohesityClusters

if (-not $json_clu -or $json_clu.Count -eq 0) {
    throw "No clusters returned from Helios."
}

# -------------------------------------------------------------
# 2ï¸âƒ£ Sort alphabetically and build index
# -------------------------------------------------------------
$sorted = $json_clu | Sort-Object -Property clusterName

$clusters = for ($i = 0; $i -lt $sorted.Count; $i++) {
    [pscustomobject]@{
        Index       = $i + 1
        ClusterName = $sorted[$i].clusterName
        ClusterId   = $sorted[$i].clusterId
    }
}

Write-Host ""
Write-Host "Available Helios Clusters (sorted by name):" -ForegroundColor Cyan
$clusters | Format-Table -AutoSize

Write-Host ""
Write-Host "[0] All clusters" -ForegroundColor Yellow
Write-Host "[X] Exit without selecting" -ForegroundColor Yellow
Write-Host ""

# -------------------------------------------------------------
# 3ï¸âƒ£ Let user select ALL, ONE, or EXIT
# -------------------------------------------------------------
while ($true) {

    $inputVal = Read-Host "Enter 0 for ALL, 1-$($clusters.Count) for single, or X to exit"

    if ($inputVal -match '^(x|X|q|Q)$') {
        Write-Host "Exit selected. No clusters chosen." -ForegroundColor Cyan
        return
    }

    [int]$num = 0
    if (-not [int]::TryParse($inputVal, [ref]$num)) {
        Write-Host "Please enter a valid number or X to exit." -ForegroundColor Red
        continue
    }

    if ($num -lt 0 -or $num -gt $clusters.Count) {
        Write-Host "Please enter 0, 1-$($clusters.Count), or X to exit." -ForegroundColor Red
        continue
    }

    $selection = $num
    break
}

if ($selection -eq 0) {
    $SelectedClusters   = $clusters
    $SelectedClusterIds = $clusters.ClusterId

    Write-Host ""
    Write-Host "You selected: ALL clusters" -ForegroundColor Green
    $SelectedClusters | Format-Table -AutoSize
}
else {
    $selectedCluster    = $clusters | Where-Object { $_.Index -eq $selection }
    $SelectedClusters   = @($selectedCluster)
    $SelectedClusterIds = @($selectedCluster.ClusterId)

    Write-Host ""
    Write-Host "You selected cluster:" -ForegroundColor Green
    Write-Host "  Name: $($selectedCluster.ClusterName)"
    Write-Host "  Id:   $($selectedCluster.ClusterId)"
    Write-Host ""
}

# -------------------------------------------------------------
# 4ï¸âƒ£ Helpers: time + size + reduction + K-format
# -------------------------------------------------------------
function Get-TimeMsecs {
    param(
        [Parameter(Mandatory = $true)][datetime]$Date
    )
    $epoch = [datetime]::SpecifyKind([datetime]'1970-01-01T00:00:00Z', [System.DateTimeKind]::Utc)
    return [int64]($Date.ToUniversalTime() - $epoch).TotalMilliseconds
}

# Decimal TB/GB/MB/KB with 1 decimal
function Format-Size {
    param(
        [Parameter(Mandatory = $true)]
        [long]$Size
    )

    $abs = [math]::Abs($Size)

    if ($abs -ge 1e12) {          # 1 TB = 1,000,000,000,000 bytes
        $value = $Size / 1e12
        $unit  = 'TB'
    }
    elseif ($abs -ge 1e9) {       # 1 GB = 1,000,000,000 bytes
        $value = $Size / 1e9
        $unit  = 'GB'
    }
    elseif ($abs -ge 1e6) {       # 1 MB = 1,000,000 bytes
        $value = $Size / 1e6
        $unit  = 'MB'
    }
    elseif ($abs -ge 1e3) {       # 1 KB = 1,000 bytes
        $value = $Size / 1e3
        $unit  = 'KB'
    }
    else {
        $value = $Size
        $unit  = 'B'
    }

    "{0:N1} {1}" -f $value, $unit   # 1 decimal always
}

function Format-K {
    param([long]$Value)

    if ($null -eq $Value) { return $null }
    if ($Value -eq 0)     { return "0" }

    $abs = [math]::Abs([double]$Value)
    if ($abs -lt 1000) { return ("{0:N0}" -f $Value) }

    return ("{0:N1}K" -f ($Value / 1e3))
}

function Compute-Reduction {
    param(
        [long]$LogicalBytes,
        [long]$PhysicalBytes
    )

    if ($PhysicalBytes -le 0 -or $LogicalBytes -le 0) { return "-" }

    $ratio = [double]$LogicalBytes / [double]$PhysicalBytes
    "{0:N1}x" -f $ratio
}

# -------------------------------------------------------------
# 5ï¸âƒ£ Time window for growth (last $Days days)
# -------------------------------------------------------------
$endDate   = Get-Date
$startDate = $endDate.AddDays(-$Days)

$startDateString = $startDate.ToString("yyyy-MM-dd")
$endDateString   = $endDate.ToString("yyyy-MM-dd")

$startDateMsecs = Get-TimeMsecs -Date $startDate
$endDateMsecs   = Get-TimeMsecs -Date $endDate

# -------------------------------------------------------------
# 6ï¸âƒ£ Accumulators for global TOTAL + combined table rows
# -------------------------------------------------------------
$combinedAll             = @()

$globalLogicalNowBytes   = 0L
$globalPhysicalNowBytes  = 0L
$globalResiliencyBytes   = 0L
$globalConsumedBytes     = 0L
$globalFiles             = 0L
$globalDirs              = 0L

# -------------------------------------------------------------
# 7ï¸âƒ£ For each selected cluster: growth + current stats (GET only)
# -------------------------------------------------------------
foreach ($cid in $SelectedClusterIds) {

    $cluster_name = ($SelectedClusters | Where-Object { $_.ClusterId -eq $cid }).ClusterName

    $headers = @{
        "apiKey"          = $apiKey
        "accessClusterId" = $cid
    }

    # 7.1 Get basic views (for viewId + name)
    try {
        $viewsUrl  = "$baseIris/views"
        $viewsResp = Invoke-WebRequest -Method Get -Uri $viewsUrl -Headers $headers
        $viewsJson = $viewsResp.Content | ConvertFrom-Json
        $views     = $viewsJson.views
    }
    catch {
        Write-Host "Failed to get views for cluster '$cluster_name' (Id: $cid): $_" -ForegroundColor Red
        continue
    }

    if (-not $views) {
        Write-Host "No views returned for cluster '$cluster_name'." -ForegroundColor Yellow
        continue
    }

    $views = $views | Sort-Object -Property name

    # -------------------------------------------
    # 7.A Build growth data from timeSeriesStats
    # -------------------------------------------
    $growthResults = @()

    foreach ($view in $views) {

        $viewName = $view.name
        $viewId   = $view.viewId

        $statsUrl =
            "$baseIris/statistics/timeSeriesStats" +
            "?endTimeMsecs=$endDateMsecs" +
            "&startTimeMsecs=$startDateMsecs" +
            "&entityId=$viewId" +
            "&metricName=kSystemUsageBytes" +
            "&metricUnitType=0" +
            "&range=week" +
            "&rollupFunction=latest" +
            "&rollupIntervalSecs=14400" +
            "&schemaName=kBridgeViewLogicalStats"

        try {
            $statsResp = Invoke-WebRequest -Method Get -Uri $statsUrl -Headers $headers
            $stats     = $statsResp.Content | ConvertFrom-Json
        }
        catch {
            Write-Host "  âš  Failed to get growth stats for view '$viewName' on '$cluster_name': $_" -ForegroundColor Red
            continue
        }

        if (-not $stats -or -not $stats.dataPointVec -or $stats.dataPointVec.Count -eq 0) {
            # Still capture the view with zero growth
            $growthResults += [pscustomobject]@{
                ClusterName   = $cluster_name
                ViewName      = $viewName
                StartBytes    = 0L
                EndBytes      = 0L
                LogicalStart  = "0 B"
                LogicalEnd    = "0 B"
                GrowthSize    = "0 B"
                PercentGrowth = "N/A"
            }
            continue
        }

        $startBytes  = [int64]$stats.dataPointVec[0].data.int64Value
        $endBytes    = [int64]$stats.dataPointVec[-1].data.int64Value
        $growthBytes = $endBytes - $startBytes

        $startFmt    = Format-Size -Size $startBytes
        $endFmt      = Format-Size -Size $endBytes
        $growthFmt   = Format-Size -Size $growthBytes

        if ($startBytes -gt 0) {
            $pct    = [math]::Round(($growthBytes * 100.0) / $startBytes, 1)
            $pctFmt = "{0:N1} %" -f $pct
        }
        else {
            $pctFmt = "N/A"
        }

        $growthResults += [pscustomobject]@{
            ClusterName   = $cluster_name
            ViewName      = $viewName
            StartBytes    = $startBytes
            EndBytes      = $endBytes
            LogicalStart  = $startFmt
            LogicalEnd    = $endFmt
            GrowthSize    = $growthFmt
            PercentGrowth = $pctFmt
        }
    }

    # -------------------------------------------
    # 7.B Get current capacity stats (includeStats=true)
    #      from views.stats.dataUsageStats
    # -------------------------------------------
    $viewsStatsUrl  = "$baseIris/views?includeStats=true"
    $snapshotByName = @{}

    try {
        $vsResp  = Invoke-WebRequest -Method Get -Uri $viewsStatsUrl -Headers $headers
        $vsJson  = $vsResp.Content | ConvertFrom-Json
        if ($vsJson.views) {
            $viewsWithStats = $vsJson.views
        }
        else {
            $viewsWithStats = $vsJson
        }
    }
    catch {
        Write-Host "  âš  Failed to get includeStats for cluster '$cluster_name': $_" -ForegroundColor Red
        $viewsWithStats = @()
    }

    foreach ($view in $viewsWithStats) {

        $name = $view.name
        if (-not $name) { continue }

        $stats = $view.stats.dataUsageStats
        if (-not $stats) { continue }

        # Some APIs may return an array; take the first
        if ($stats -is [System.Collections.IEnumerable] -and
            -not ($stats -is [string])) {
            $stats = $stats[0]
        }

        $logicalNowBytes   = [int64]$stats.totalLogicalUsageBytes
        $physicalNowBytes  = [int64]$stats.localTotalPhysicalUsageBytes
        $overheadBytes     = [int64]$stats.localTierResiliencyImpactBytes
        $consumedBytes     = [int64]$stats.storageConsumedBytes
        $numFilesRaw       = [int64]$stats.numFiles
        $numDirsRaw        = [int64]$stats.numDirectories

        $reductionNow      = Compute-Reduction -LogicalBytes $logicalNowBytes -PhysicalBytes $physicalNowBytes

        $snapshotByName[$name] = [pscustomobject]@{
            LogicalNowBytes   = $logicalNowBytes
            PhysicalNowBytes  = $physicalNowBytes
            ResiliencyBytes   = $overheadBytes
            ConsumedBytes     = $consumedBytes
            NumFilesRaw       = $numFilesRaw
            NumDirsRaw        = $numDirsRaw

            LogicalNow        = Format-Size $logicalNowBytes
            PhysicalNow       = Format-Size $physicalNowBytes
            ReductionNow      = $reductionNow
            ResiliencyOver    = Format-Size $overheadBytes
            ConsumedNow       = Format-Size $consumedBytes
            NumFiles          = Format-K  $numFilesRaw
            NumDirs           = Format-K  $numDirsRaw
        }
    }

    if (-not $growthResults) {
        Write-Host "No view growth data collected for cluster '$cluster_name'." -ForegroundColor Yellow
        continue
    }

    # ---------------------------------------------------------
    # 7.C Combine: growth (7d) + current snapshot (Now)
    # ---------------------------------------------------------
    $combined = @()

    foreach ($g in ($growthResults | Sort-Object -Property ViewName)) {

        $snap = $null
        if ($snapshotByName.ContainsKey($g.ViewName)) {
            $snap = $snapshotByName[$g.ViewName]
        }

        if ($snap) {
            $logicalNowDisplay = $snap.LogicalNow
            $physicalNow       = $snap.PhysicalNow
            $reductionNow      = $snap.ReductionNow
            $overheadNow       = $snap.ResiliencyOver
            $consumedNow       = $snap.ConsumedNow
            $numFiles          = $snap.NumFiles
            $numDirs           = $snap.NumDirs

            $logicalNowBytesForTotal  = $snap.LogicalNowBytes
            $physicalNowBytesForTotal = $snap.PhysicalNowBytes
            $overheadBytesForTotal    = $snap.ResiliencyBytes
            $consumedBytesForTotal    = $snap.ConsumedBytes
            $numFilesRawForTotal      = $snap.NumFilesRaw
            $numDirsRawForTotal       = $snap.NumDirsRaw
        }
        else {
            # No includeStats for this view â€“ fallback to endBytes for logical, 0 for others
            $logicalNowDisplay        = $g.LogicalEnd
            $physicalNow              = "0 B"
            $reductionNow             = "-"
            $overheadNow              = "0 B"
            $consumedNow              = "0 B"
            $numFiles                 = ""
            $numDirs                  = ""

            $logicalNowBytesForTotal  = $g.EndBytes
            $physicalNowBytesForTotal = 0L
            $overheadBytesForTotal    = 0L
            $consumedBytesForTotal    = 0L
            $numFilesRawForTotal      = 0L
            $numDirsRawForTotal       = 0L
        }

        $combined += [pscustomobject]@{
            ClusterName        = $g.ClusterName
            ViewName           = $g.ViewName

            # raw bytes for math/totals
            StartBytes         = $g.StartBytes
            EndBytes           = $g.EndBytes
            LogicalNowBytes    = $logicalNowBytesForTotal
            PhysicalNowBytes   = $physicalNowBytesForTotal
            ResiliencyBytes    = $overheadBytesForTotal
            ConsumedBytes      = $consumedBytesForTotal
            NumFilesRaw        = $numFilesRawForTotal
            NumDirsRaw         = $numDirsRawForTotal

            # formatted columns
            LogicalStart       = $g.LogicalStart
            LogicalEnd         = $g.LogicalEnd
            GrowthSize         = $g.GrowthSize
            PercentGrowth      = $g.PercentGrowth

            LogicalNow         = $logicalNowDisplay
            PhysicalNow        = $physicalNow
            ReductionNow       = $reductionNow
            ResiliencyOverhead = $overheadNow
            ConsumedNow        = $consumedNow
            NumFiles           = $numFiles
            NumDirs            = $numDirs
        }
    }

    if (-not $combined) {
        Write-Host "No combined rows for cluster '$cluster_name'." -ForegroundColor Yellow
        continue
    }

    # ---------------------------------------------------------
    # 7.D Cluster totals (for TOTAL row and global accumulation)
    # ---------------------------------------------------------
    $totStartBytes       = [int64](($combined.StartBytes       | Measure-Object -Sum).Sum)
    $totEndBytes         = [int64](($combined.EndBytes         | Measure-Object -Sum).Sum)
    $totLogicalNowBytes  = [int64](($combined.LogicalNowBytes  | Measure-Object -Sum).Sum)
    $totPhysicalNowBytes = [int64](($combined.PhysicalNowBytes | Measure-Object -Sum).Sum)
    $totResiliencyBytes  = [int64](($combined.ResiliencyBytes  | Measure-Object -Sum).Sum)
    $totConsumedBytes    = [int64](($combined.ConsumedBytes    | Measure-Object -Sum).Sum)
    $totFilesRaw         = [int64](($combined.NumFilesRaw      | Measure-Object -Sum).Sum)
    $totDirsRaw          = [int64](($combined.NumDirsRaw       | Measure-Object -Sum).Sum)

    $totGrowthBytes      = $totEndBytes - $totStartBytes
    $totStartFmt         = Format-Size $totStartBytes
    $totEndFmt           = Format-Size $totEndBytes
    $totGrowthFmt        = Format-Size $totGrowthBytes

    if ($totStartBytes -gt 0) {
        $totPct    = [math]::Round(($totGrowthBytes * 100.0) / $totStartBytes, 1)
        $totPctFmt = "{0:N1} %" -f $totPct
    }
    else {
        $totPctFmt = "N/A"
    }

    $totalReduction      = Compute-Reduction -LogicalBytes $totLogicalNowBytes -PhysicalBytes $totPhysicalNowBytes
    $totLogicalNowFmt    = Format-Size $totLogicalNowBytes
    $totPhysicalNowFmt   = Format-Size $totPhysicalNowBytes
    $totResiliencyFmt    = Format-Size $totResiliencyBytes
    $totConsumedFmt      = Format-Size $totConsumedBytes
    $totFilesFmt         = Format-K    $totFilesRaw
    $totDirsFmt          = Format-K    $totDirsRaw

    # Accumulate into global totals (sanity: same numbers used in cluster TOTAL row)
    $globalLogicalNowBytes  += $totLogicalNowBytes
    $globalPhysicalNowBytes += $totPhysicalNowBytes
    $globalResiliencyBytes  += $totResiliencyBytes
    $globalConsumedBytes    += $totConsumedBytes
    $globalFiles            += $totFilesRaw
    $globalDirs             += $totDirsRaw

    # Cluster TOTAL row (will appear at bottom of this cluster in combined table)
    $totalRow = [pscustomobject]@{
        ClusterName        = $cluster_name
        ViewName           = 'TOTAL'

        LogicalStart       = $totStartFmt
        LogicalEnd         = $totEndFmt
        GrowthSize         = $totGrowthFmt
        PercentGrowth      = $totPctFmt

        LogicalNow         = $totLogicalNowFmt
        PhysicalNow        = $totPhysicalNowFmt
        ReductionNow       = $totalReduction
        ResiliencyOverhead = $totResiliencyFmt
        ConsumedNow        = $totConsumedFmt
        NumFiles           = $totFilesFmt
        NumDirs            = $totDirsFmt
    }

    # Cluster rows in order: views first, TOTAL last
    $combinedSorted      = $combined | Sort-Object -Property ViewName
    $clusterRowsCombined = @()
    $clusterRowsCombined += $combinedSorted
    $clusterRowsCombined += $totalRow

    # Add to global combined table
    $combinedAll += $clusterRowsCombined

    # Optional: cluster CSV for reference (views + TOTAL)
    $safeClusterName = ($cluster_name -replace ':', '_')
    $outFileName     = "ViewGrowthAndCapacity_${safeClusterName}_$($startDateString)_$($endDateString).csv"
    $outFilePath     = Join-Path -Path $logDirectory -ChildPath $outFileName

    $clusterRowsCombined |
        Select-Object ClusterName,
                      ViewName,
                      @{Name="StartLogical(${Days}dAgo)"; Expression={ $_.LogicalStart }},
                      @{Name="EndLogical(${Days}dEnd)";   Expression={ $_.LogicalEnd }},
                      @{Name="Growth(${Days}d)";          Expression={ $_.GrowthSize }},
                      @{Name="Growth%(${Days}d)";         Expression={ $_.PercentGrowth }},
                      LogicalNow,
                      PhysicalNow,
                      ReductionNow,
                      ResiliencyOverhead,
                      ConsumedNow,
                      NumFiles,
                      NumDirs |
        Export-Csv -Path $outFilePath -NoTypeInformation

    Write-Host "ðŸ“„ Cluster CSV written for '$cluster_name': $outFilePath" -ForegroundColor Green
}

# -------------------------------------------------------------
# 8ï¸âƒ£ Global CURRENT capacity table (Table 1)
# -------------------------------------------------------------
if (-not $combinedAll -or $combinedAll.Count -eq 0) {
    Write-Host ""
    Write-Host "No data collected for any selected cluster." -ForegroundColor Yellow
    return
}

$globalLogicalNowFmt  = Format-Size $globalLogicalNowBytes
$globalPhysicalNowFmt = Format-Size $globalPhysicalNowBytes
$globalResiliencyFmt  = Format-Size $globalResiliencyBytes
$globalConsumedFmt    = Format-Size $globalConsumedBytes
$globalFilesFmt       = Format-K    $globalFiles
$globalDirsFmt        = Format-K    $globalDirs
$globalReduction      = Compute-Reduction -LogicalBytes $globalLogicalNowBytes -PhysicalBytes $globalPhysicalNowBytes

$globalRow = [pscustomobject]@{
    Scope              = 'GLOBAL'
    LogicalNow         = $globalLogicalNowFmt
    PhysicalNow        = $globalPhysicalNowFmt
    ReductionNow       = $globalReduction
    ResiliencyOverhead = $globalResiliencyFmt
    ConsumedNow        = $globalConsumedFmt
    NumFiles           = $globalFilesFmt
    NumDirs            = $globalDirsFmt
}

Write-Host ""
Write-Host "=== GLOBAL CURRENT CAPACITY (All Selected Clusters) ===" -ForegroundColor Cyan
Write-Host ""

$globalRow |
    Format-Table `
        Scope,
        LogicalNow,
        PhysicalNow,
        ReductionNow,
        ResiliencyOverhead,
        ConsumedNow,
        NumFiles,
        NumDirs -AutoSize

# -------------------------------------------------------------
# 9ï¸âƒ£ Combined cluster table (Table 2: growth + current)
# -------------------------------------------------------------
Write-Host ""
Write-Host "ðŸ“… $Days-day window (used only for growth columns below): $startDateString -> $endDateString" -ForegroundColor Yellow
Write-Host ""

Write-Host "GROWTH (Last $Days days)                                  | CURRENT CAPACITY (Now)" -ForegroundColor DarkCyan
Write-Host "--------------------------------------------------------- | ------------------------" -ForegroundColor DarkCyan

$combinedAll |
    Format-Table `
        ClusterName,
        ViewName,
        @{ Label = "StartLogical(${Days}dAgo)"; Expression = { $_.LogicalStart } },
        @{ Label = "EndLogical(${Days}dEnd)";   Expression = { $_.LogicalEnd } },
        @{ Label = "Growth(${Days}d)";          Expression = { $_.GrowthSize } },
        @{ Label = "Growth%(${Days}d)";         Expression = { $_.PercentGrowth } },
        @{ Label = "LogicalNow";                Expression = { $_.LogicalNow } },
        @{ Label = "PhysicalNow";               Expression = { $_.PhysicalNow } },
        @{ Label = "ReductionNow";              Expression = { $_.ReductionNow } },
        @{ Label = "ResiliencyOverhead";        Expression = { $_.ResiliencyOverhead } },
        @{ Label = "ConsumedNow";               Expression = { $_.ConsumedNow } },
        @{ Label = "NumFiles";                  Expression = { $_.NumFiles } },
        @{ Label = "NumDirs";                   Expression = { $_.NumDirs } } `
    -AutoSize
