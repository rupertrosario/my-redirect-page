import { execution } from "@dynatrace-sdk/automation-utils";

export default async function ({ execution_id }) {
  const ex     = await execution(execution_id);
  const result = await ex.result(execute_dql_query_1);   // keep your existing step id

  // DQL rows: clusterName, used_TB, total_TB, used_pct_rounded, etc.
  const rows = result.records ?? [];

  // Pick what you care about per cluster
  const clusters = rows.map(r => ({
    clusterName:      r.clusterName,
    usedTB:           r.used_TB,
    totalTB:          r.total_TB,
    usedPct:          r.used_pct_rounded,
    usedPctLabel:     r.used_pct_label,
    usedHddBytes:     r.used_hdd_bytes,
    totalHddBytes:    r.total_hdd_bytes,
    usedSddBytes:     r.used_sdd_bytes,
    totalSddBytes:    r.total_sdd_bytes
  }));

  console.log("Isilon clusters:", clusters.length);

  // This is what youâ€™ll see in Sample results
  return { clusters };
}
