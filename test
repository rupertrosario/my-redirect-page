function Get-PropValue {
    param(
        [Parameter(Mandatory=$true)]$PropertyList,
        [Parameter(Mandatory=$true)][string[]]$Names
    )

    # Case 1: propertyList is a hashtable/dictionary
    if ($PropertyList -is [hashtable] -or $PropertyList.GetType().Name -match 'Dictionary') {
        foreach ($n in $Names) {
            if ($PropertyList.ContainsKey($n) -and $PropertyList[$n]) { return $PropertyList[$n] }
        }
        return $null
    }

    # Case 2: propertyList is an array of objects (key/value, name/value, etc.)
    foreach ($n in $Names) {
        $p = $PropertyList | Where-Object {
            $_.key -eq $n -or $_.name -eq $n -or $_.propertyName -eq $n -or $_.property -eq $n
        } | Select-Object -First 1

        if ($p) {
            return ($p.value ?? $p.val ?? $p.propertyValue ?? $p.stringValue ?? $p)
        }
    }

    return $null
}

$json.alertsList |
Where-Object { $_.alertCode -eq 'CE3601105' } |
ForEach-Object {
    $ip = Get-PropValue -PropertyList $_.propertyList -Names @(
        'ip','ipAddress','sourceIp','remoteIp','hostIp','clientIp'
    )

    if (-not $ip) { return }  # skip if no IP found

    [pscustomobject]@{
        AlertCode   = $_.alertCode
        IP          = $ip
        ClusterName = $_.clusterName
        ClusterId   = $_.clusterId
        Severity    = $_.severity
        Details     = $_.alertDocument
        PropertyList = $_.propertyList
    }
}
