import { credentialVaultClient } from "@dynatrace-sdk/client-classic-environment-v2";

export default async function () {
  const vaultId = "credentials_vault-312312";
  try {
    const sec = await credentialVaultClient.getCredentialById({ id: vaultId });
    const key = (sec?.token ?? sec?.password ?? sec?.value ?? "").trim();
    return { markdownEmail: `VAULT_OK id=${vaultId} len=${key.length}` };
  } catch (e) {
    // force the real error into the workflow output
    const msg = e?.message ? String(e.message) : String(e);
    const name = e?.name ? String(e.name) : "";
    const stack = e?.stack ? String(e.stack).slice(0, 1200) : "";
    return { markdownEmail: `VAULT_FAIL id=${vaultId}\nname=${name}\nmsg=${msg}\nstack=${stack}` };
  }
}
