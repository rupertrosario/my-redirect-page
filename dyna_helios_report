import { credentialVaultClient } from "@dynatrace-sdk/client-classic-environment-v2";

/**
 * Vault validation (ID-only; matches your working pattern)
 * Expected: returns markdownEmail = "VAULT_OK len=<n>"
 */
export default async function () {
  const vaultId = "credentials_vault-312312"; // your secret id

  const d2 = await credentialVaultClient.getCredentialsDetails({ id: vaultId });
  const apiKey = (d2?.token || d2?.password || "").trim();

  if (!apiKey) {
    return { markdownEmail: "VAULT_FAIL (empty token/password). Check secret value/type." };
  }

  return { markdownEmail: `VAULT_OK len=${apiKey.length}` };
}
